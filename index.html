<!DOCTYPE html>
<html>

<head>
    <title>Mapa com Leaflet + Sidebar</title>
    <style>
        @import url(https://unpkg.com/leaflet@1.9.4/dist/leaflet.css);

        html,
        body {
            height: 100%;
            margin: 0px;
            padding: 0;
        }

        #map {
            height: 100%;
            transition: transform 0.3s ease;
            transform: translateX(0px);
        }

        body.sidebar-hidden #map {
            transform: translateX(0);
        }

        .sidebar {
            position: fixed;
            top: 0;
            right: 0;
            width: 200px;
            height: 100%;
            background: lab(94.8% 0.01 -0.01 / 0.199);
            border-left: 1px solid #ccc;
            padding: 12px;
            overflow-y: auto;
            transition: transform 0.3s ease;
            z-index: 999;
        }

        .sidebar.hidden {
            transform: translateX(250px);
        }

        .toggle-btn {
            position: fixed;
            top: 10px;
            right: 10px;
            background: lab(21.25% 0 0 / 0.50);
            color: #fff;
            padding: 5px 10px;
            cursor: pointer;
            z-index: 1000;
        }

        ul {
            list-style: none;
            padding: 0;
        }

        li {
            margin: 10px 0;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="toggle-btn" id="toggle-btn">&#9776;</div>

    <div class="sidebar" id="sidebar">
        <h4>Empreendimentos</h4>
        <ul id="emp-list"></ul>
    </div>

    <div id="map"></div>

    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <script>
        var map = L.map('map').setView([-14.2350, -51.9253], 4);

        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Toggle da sidebar
        document.getElementById('toggle-btn').addEventListener('click', function () {
            document.querySelector('.sidebar').classList.toggle('hidden');
            document.body.classList.toggle('sidebar-hidden');
            setTimeout(() => {
                map.invalidateSize();
            }, 310);
        });

        // Carrega polígonos
        fetch('Danos.geojson')
            .then(res => res.json())
            .then(poligonosData => {
                L.geoJSON(poligonosData, {
                    style: {
                        color: 'red',
                        weight: 2,
                        fillOpacity: 0.3
                    },
                    onEachFeature: function (feature, layer) {
                        let popupContent = '';
                        for (const key in feature.properties) {
                            popupContent += `<strong>${key}</strong>: ${feature.properties[key]}<br>`;
                        }
                        layer.bindPopup(popupContent);
                    }
                }).addTo(map);
            });

        // Carrega pontos
        fetch('Danos ponto.geojson')
            .then(res => res.json())
            .then(pontosData => {
                L.geoJSON(pontosData, {
                    pointToLayer: function (feature, latlng) {
                        const customIcon = L.icon({
                            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png',
                            iconSize: [25, 35],
                            iconAnchor: [12, 35],
                            popupAnchor: [0, -30]
                        });
                        return L.marker(latlng, { icon: customIcon });
                    },
                    onEachFeature: function (feature, layer) {
                        let popupContent = '';
                        for (const key in feature.properties) {
                            popupContent += `<strong>${key}</strong>: ${feature.properties[key]}<br>`;
                        }
                        layer.bindPopup(popupContent);

                        // Adiciona item à sidebar
                        const nome = feature.properties['Empreendim'] || 'Sem Nome';
                        const li = document.createElement('li');
                        li.textContent = nome;
                        li.onclick = () => {
                            map.setView(layer.getLatLng(), 14);
                            layer.openPopup();
                        };
                        document.getElementById('emp-list').appendChild(li);
                    }
                }).addTo(map);
            });
    </script>
</body>

</html>
